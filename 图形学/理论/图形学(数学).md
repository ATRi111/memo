## 向量与矩阵

$$
m\times n矩阵:\mathbf A=
\begin{bmatrix}
a_{11} & a_{12} & \cdots & a_{1n} \\
a_{21} & a_{22} & \cdots & a_{2n} \\
\vdots & \vdots & \ddots & \vdots \\
a_{m1} & a_{m2} & \cdots & a_{mn} \\
\end{bmatrix}
=[a_{ij}]_{m\times n}=
\begin{bmatrix}
\mathbf A^1 & \mathbf A^2 & \cdots & \mathbf A^n \\
\end{bmatrix}
=
\begin{bmatrix}
\mathbf A_1 \\ 
\mathbf A_2 \\ 
\cdots \\ 
\mathbf A_m \\
\end{bmatrix}
\hfill \\
\\
矩阵乘法:\mathbf A_{m\times p}\mathbf B_{p\times n}=\mathbf C_{m\times n} \quad (\textbf{行m-列p-行p-列n}) \quad ,其中c_{ij}=\mathbf A_i \cdot \mathbf B^j \quad (点积)\hfill \\
\\
向量:\mathbf a=\begin{bmatrix} x_a \\ y_a \\ z_a \end{bmatrix},
\mathbf a^T=\begin{bmatrix} x_a & y_a & z_a \end{bmatrix}\hfill \\
点积:\mathbf a \cdot \mathbf b=\mathbf a^T\mathbf b=\Sigma a_ib_i \hfill \\
叉积:\mathbf a \times \mathbf b = 
\begin{bmatrix}
0 & -z_a & y_a \\
z_a & 0 & -x_a \\
-y_a & x_a & 0 \\
\end{bmatrix}
\begin{bmatrix}
x_b \\
y_b \\
z_b \\
\end{bmatrix}
=\begin{bmatrix}
y_az_b-y_bz_a \\
x_az_b-x_bz_a \\
x_ay_b-x_by_a \\
\end{bmatrix}
\hfill \\
投影:\mathbf a \bullet \mathbf b= \frac{\mathbf a\cdot\mathbf b}{|\mathbf b|} \frac{\mathbf b}{|\mathbf b|} \quad 若\mathbf b为单位向量,则\mathbf a \bullet \mathbf b=(\mathbf a \cdot \mathbf b)\mathbf b \hfill \\
长度:|\mathbf a|=\sqrt{\mathbf a \cdot \mathbf a} \hfill \\
夹角:\cos\langle\mathbf a,\mathbf b\rangle= \frac{\mathbf a \cdot \mathbf b}{|\mathbf a||\mathbf b|} \hfill \\
$$

## 四元数

<img src="屏幕截图 2022-01-19 104539.jpg" alt="屏幕截图 2022-01-19 104539" style="zoom:50%;" />
$$
四元数:\mathbf q = q_0+\mathbf v_q =q_0+q_1\mathbf i+q_2\mathbf j+q_3\mathbf k(q_0,q_1,q_2,q_3为实数) \quad 共轭四元数:\mathbf q^* = q_0-\mathbf v_q \hfill \\
四元数的二范数:|\mathbf q|= (q_0^2+|\mathbf v_q|^2)^{\frac{1}{2}} = \sqrt{q^2_0+q_1^2+q_2^2+q_3^2}\hfill \\
\mathbf p \cdot \mathbf q= q_0p_0+q_1p_1+q_2p_2+q_3p_3 \quad (类似向量点乘) \hfill  \\
\mathbf p \times \mathbf q= \mathbf v_p \times \mathbf v_q = (p_2q_3-p_3q_2)\mathbf i+(p_3q_1-p_1q_3)\mathbf j+(p_1q_2-p_2q_1) \mathbf k \quad (类似向量叉乘) \hfill \\
\mathbf p \mathbf q = (p_0q_0 - \mathbf v_1 \cdot \mathbf v_2) +(p_0 \mathbf v_2 + q_0 \mathbf v_1 + \mathbf v_1 \times \mathbf v_2) \quad (默认乘法) \hfill \\
\mathbf q^{-1} =\frac{\mathbf q^*}{|\mathbf q|^2}, \mathbf q_1 \mathbf q_2 = \mathbf q_3 \Leftrightarrow \mathbf q_2 = \mathbf q_1^{-1} \mathbf q_3 \hfill \\
\\
四元数表示旋转: \hfill \\ 
\mathbf q = \cos \frac{\theta}{2}+\sin\frac{\theta}{2}\mathbf v_q (|\mathbf v_q|=1 \Rightarrow |\mathbf q|=1)
\quad \mathbf p=\mathbf v_p \quad 
\mathbf r = \mathbf q\mathbf p\mathbf q^{-1} \hfill \\
\mathbf q:表示旋转的四元数,\theta为旋转角,\mathbf v_q为转轴(必须是归一化的) \hfill \\ 
\mathbf p:表示初始坐标的四元数(实部为0,虚部系数即坐标) \hfill \\
\mathbf r:表示旋转后坐标的四元数(结果中虚部系数即坐标) \hfill \\
$$

- 四元数叉乘、默认乘法不满足交换律

## 变换

- **变换：函数，自变量和因变量均为n维向量**
- **线性变换：具有线性性质的变换（包括缩放、旋转、切变等；不包括平移）**
  - **线性变换和平移统称为仿射变换**

- **齐次坐标：用于表示n维向量及其各类变换的n+1维坐标**

$$
n维空间中有变换\mathbf A,若\forall向量 \mathbf a,\mathbf b,实数k,有:
\begin{cases}
\mathbf A(\mathbf a+\mathbf b)=\mathbf A(\mathbf a)+\mathbf A(\mathbf b) \\
\mathbf A(k\mathbf a)=k\mathbf A(\mathbf a) \\
\end{cases},
则\mathbf A为\textbf{线性变换} \hfill \\
n维空间中的线性变换总是可以表示为\mathbf b=\mathbf L_{n\times n}\mathbf a \hfill \\
一切仿射变换可以表示为\mathbf b=\mathbf L_{n\times n}\mathbf a+\mathbf t \hfill \\
引入齐次坐标后,\mathbf b=\mathbf L_{n\times n}\mathbf a+\mathbf t可以表示为\mathbf b'=\mathbf M_{(n+1)\times (n+1)}\mathbf a', 
其中\mathbf b'=\begin{bmatrix} \mathbf b \\ 1 \end{bmatrix},
\mathbf a'=\begin{bmatrix} \mathbf a \\ 1 \end{bmatrix},
\mathbf M=\begin{bmatrix}\mathbf L & \mathbf t \\ 0 & 1 \end{bmatrix} \hfill \\
$$

### 二维

$$
缩放(x,y)倍:
\mathbf L =
\begin{bmatrix}
x & 0 \\
0 & y \\
\end{bmatrix} \hfill \\
切变:
\mathbf L_x =
\begin{bmatrix}
1 & s \\
0 & 1 \\
\end{bmatrix},
\mathbf L_y =
\begin{bmatrix}
1 & 0 \\\
s & 1 \\
\end{bmatrix}
\hfill \\
绕原点逆时针旋转\theta:
\mathbf L =
\begin{bmatrix}
\cos \theta & -\sin \theta \\
\sin \theta & \cos \theta \\
\end{bmatrix} \hfill \\
$$

### 三维

- 规定$i \times j = -k$（**左手系**，同Unity世界坐标系相同）；在此前提下，绕轴旋转均表示，从该轴的**负半轴看向正半轴**，在看到的平面内**逆时针旋转**

$$
缩放(x,y,z)倍:
\mathbf L =
\begin{bmatrix}
x & 0 & 0\\
0 & y & 0\\
0 & 0 & z\\
\end{bmatrix} \hfill \\
切变:
\mathbf L_{xy} =
\begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
s & t & 1 \\
\end{bmatrix},
\mathbf L_{xz} =
\begin{bmatrix}
1 & 0 & 0 \\
s & 1 & t \\
0 & 0 & 1 \\
\end{bmatrix},
\mathbf L_{yz} =
\begin{bmatrix}
1 & s & t \\
0 & 1 & 0 \\
0 & 0 & 1 \\
\end{bmatrix}\hfill \\
绕坐标轴旋转\theta:
\mathbf L_x =
\begin{bmatrix}
1 & 0 & 0 \\
0 & \cos \theta & -\sin \theta \\
0 & \sin \theta & \cos \theta \\
\end{bmatrix},
\mathbf L_y =
\begin{bmatrix}
\cos \theta & 0 & \sin \theta \\
0 & 1 & 0 \\
-\sin \theta & 0 & \cos \theta \\
\end{bmatrix},
\mathbf L_z =
\begin{bmatrix}
\cos \theta & -\sin \theta & 0 \\
\sin \theta & \cos \theta & 0 \\
0 & 0 & 1 \\
\end{bmatrix}\hfill \\
绕单位向量\mathbf w=\begin{bmatrix} x \\ y \\z \end{bmatrix}旋转\theta:
\mathbf L=\mathbf I+\sin \theta \mathbf J+(1-\cos\theta)\mathbf J^2,其中
\mathbf J=
\begin{bmatrix}
0 & -z & y \\
z & 0 & -x \\
-y & x & 0 \\
\end{bmatrix}
\hfill \\
$$

## 三角形

<img src="屏幕截图 2022-01-18 111946.jpg" alt="屏幕截图 2022-01-18 111946" style="zoom:50%;" />
$$
有符号面积:S1 = \frac{1}{2}(\mathbf {CP} \times\mathbf {BP}) \cdot \mathbf n 
\quad \mathbf n = \frac{\mathbf{CA} \times \mathbf{BA}}{|\mathbf{CA}| |\mathbf{BA}|} \hfill \\
重心坐标:(\alpha,\beta,\gamma) = (\frac{S1}{S},\frac{S2}{S},\frac{S3}{S}) \Leftrightarrow \mathbf P = \alpha \mathbf A + \beta \mathbf B + \gamma \mathbf C  \hfill \\
\\
P在三角形ABC内 \Leftrightarrow S1,S2,S3>0 \hfill \\
记\mathbf c=\mathbf {AP} \times\mathbf {BP},注意到必然有\mathbf c \parallel \mathbf n(同向/反向/\mathbf a = \mathbf 0) \hfill \\
因此 S3 > 0 \Leftrightarrow \mathbf c \times \mathbf n > 0 \hfill \\
$$

- 边的方向会影响法向量方向，因此计算有符号面积时点的顺序必须统一（如以上公式）

## Split Sum

$$
有待求积分I=\frac{\int ABCDE \mathrm dx}{\int F \mathrm dx},希望\textbf{优先}分离A,E: \hfill \\
I = \frac{ \int ABCD \mathrm dx}{\int F \mathrm dx} \cdot \frac{\int ABCDE \mathrm dx}{\int ABCD\mathrm dx} 
\approx \frac{ \int ABCD \mathrm dx}{\int F \mathrm dx} \cdot \frac{\int BCDE \mathrm dx}{\int BCD\mathrm dx} \hfill \\
$$

- **应当优先考虑最需要分开的两项，其他项消掉得越多，越不准确**

## 蒙特卡洛积分法

### 重要性采样

$$
有待求积分I=\int_D f(x) \mathrm d x \hfill \\
在D上有随机变量X \sim p(X),X有样本\{X_i\},\forall x \in D,p(x)>0 \hfill \\
则I=\int_D \frac{f(x)}{p(x)}p(x) \mathrm d x  = \mathbb{E} \left[ \frac{f(x)}{p(x)} \right] \hfill \\
记Y=\frac{f(X)}{p(X)},\hat I=\frac{1}{N}\sum_{i = 1}^N Y_i,则\mathbb E\hat I =\mathbb E Y = I \hfill \\
特别地,当X服从均匀分布时,\hat I=\frac{|D|}{N}\sum_{i = 1}^N f(X_i) \quad |D|:样本空间的体积 \hfill \\
\\
\mathbb D Y= \mathbb E Y^2 - (\mathbb E Y)^2 = \int_D \left[ \frac{f(x)}{p(x)} \right]^2 p(x) \mathrm dx-\left[  \int_D \frac{f(x)}{p(x)} p(x) \mathrm dx\right]^2 \hfill \\
=\int_D \frac{f^2(x)}{p(x)} \mathrm dx - \left[  \int_D f(x) \mathrm dx\right]^2 \hfill \\
构造泛函:J[p]=\int_D \frac{f^2(x)}{p(x)} \mathrm dx + \lambda (\int_D p(x)\mathrm dx - 1) \hfill \\
\frac{\delta J}{\delta p}=0 \Rightarrow \frac{f^2(x)}{p^2(x)} - \lambda = 0 \Rightarrow p(x)= \frac{|f(x)|}{\sqrt \lambda} \hfill \\
故p(x)=\frac{|f(x)|}{\sqrt \lambda}时,\mathbb D Y最小 \Rightarrow \mathbb D \hat I最小 \hfill \\
$$

*以上公式中，$x$为任意维变量，X为任意维随机变量，Y为一维随机变量*

### 多重重要性采样

$$
在D上有一系列不同分布的随机变量X^j \sim p^j(x),j=0,1,...,M \quad X^j有样本{X^j_i} \hfill \\
取\sum_{j=1}^M w^j =1,p(x)=\sum_{j=1}^M \frac{p^j(x)}{w^j(x)} \quad p^j(x)=0时,必须有w^j(x) = 0 \hfill \\
记Y=\frac{f(X)}{p(X)},\hat I=\frac{1}{N} \sum_{i=1}^N Y_i^j, 
则Y=\sum_{j=1}^M w^j(x)\frac{f(x)}{p^j(x)},\hat I= \frac{1}{N} \sum_{i=1}^N \sum_{j=1}^M w^j(X_i^j)\frac{f(X_i^j)}{p^j(X_i^j)} \hfill \\
\Rightarrow \mathbb E \hat I= \mathbb E Y 
=\sum_{j=1}^M \mathbb E \left[ w^j(x)\frac{f(x)}{p^j(x)} \right]
= \sum_{j=1}^M \int_D w^j(x)\frac{f(x)}{p^j(x)} p^j(x) \mathrm dx = \int_D f(x) \mathrm dx=I \hfill \\
类似地,\sum_{j=1}^M \frac{p^j(x)}{w^j(x)} = \frac{|f(x)|}{\sqrt \lambda}时,\mathbb D \hat I最小 \hfill \\
$$

## 球面正态分布

$$
X \sim \mathrm{SG}(\mu,\kappa) \quad \mu:主方向 \quad \kappa:集中度(\ge 0) \hfill \\
f(\omega)=\frac{\kappa}{4 \pi \sinh \kappa}\exp{(\kappa \mu \cdot \omega)} \quad
\int_\Omega f(\omega) \mathrm d \omega = 1 \hfill \\
$$

## 球谐函数(Spherical Harmonics)

<img src="image-20250206102935725.png" alt="image-20250206102935725" style="zoom:50%;" />

*上面的图形表示球谐函数在各个方位的取值，蓝色表示正数，黄色表示负数，到原点越远，绝对值越大*
$$
\int_{\Omega} B_l^m(\omega) \mathrm d \omega=\int_0^{2\pi} \mathrm d \theta \int_\frac{-{\pi}}{2}^\frac{\pi}{2} B_l^m(\theta,\phi)\sin \phi \mathrm d\phi \hfill \\
B_l^m(\theta,\phi) = 
\begin{cases}
\sqrt2 K_l^m \cos (m\phi)P_l^m(\cos \phi)  \quad m>0 \\
\sqrt2 K_l^m \sin (-m\phi)P_l^{-m}(\cos \phi)  \quad m<0 \\
K_l^0P_l^0(\cos \phi) \quad m = 0 \\
\end{cases} \hfill \\
其中,P_n(x)=\frac{1}{2^nn!}\frac{\mathrm d^n(x^2-1)}{\mathrm dx^n} (\mathrm{Legendre多项式}) \hfill \\
P_l^m(x)=(-1)^m(1-x^2)^\frac{m}{2}\frac{\mathrm d^m P_l(x)}{\mathrm dx^m} \hfill \\
K_l^m=\sqrt{\frac{2l+1}{4\pi} \frac{(l-|m|)!}{(l+|m|)!}} \hfill \\
\\
B_l^m(\omega)具有以下性质: \hfill \\
① \int_{\Omega} B_l^m(\omega)B_k^n(\omega) \mathrm d\omega
=\begin{cases}
1 \quad (l = k,且m=n) \\
0 \quad (其他)  \\
\end{cases} \hfill \\
\\
f(\omega) \approx \sum_{l=0}^{b} \sum_{m=-l}^l c_l^mB_l^m(\omega) \hfill \\
其中c_l^m=\int_{\Omega} f(\omega)B_l^m(\omega) \mathrm d\omega,称为f(\omega)在B_l^m(\omega)上的\textbf{投影} \hfill \\
若还有g(\omega) \approx \sum_{l=0}^{b} \sum_{m=-l}^l d_l^mB_l^m(\omega) \hfill \\
则\int_{\Omega^{+}} f(x)g(x) \mathrm d\omega= \sum_{l=0}^{b} \sum_{m=-l}^l c_l^md_l^m \int_{\Omega^{+}} [B_l^m(\omega)]^2 \mathrm d \omega 
= \sum_{l=0}^{b} \sum_{m=-l}^l c_l^md_l^m
$$

- 一系列定义在球面上的**基函数**（可以转化为球面坐标系下的二元函数），多个基函数组合起来近似表示原函数
- **最重要的性质是正交性，将两个函数均用球谐函数（近似）表示，则可以利用正交性加速积分计算**
- **原函数旋转，相当于将所有基函数旋转；旋转后的某个基函数总是可以用同阶基函数的线性组合表示**
- 第$l$阶有$2l+1$个不同的球谐函数；**阶数越高，频率越高**
- **两函数乘积的频率取决于两函数中频率较低的一个**
  - **只使用前若干阶基函数近似，相当于消除了一定范围内的高频信息**
- **理论上，计算球谐函数系数的方式是，将原函数和各个球谐函数相乘后求积分；而实际上，原函数和各个球谐函数都通过分辨率有限的贴图（通常是立方体贴图）来表示，因此实际计算时变为离散的相乘-求和**

## 小波变换（？）

- **直接在立方体贴图上，对每个面的纹理近似**
- **能够以较低的成本记录足够高频的信息**
- 得到的结果能较好地反映镜面反射

