# 软件架构

- 软件架构：在一定的设计原则基础上，从不同角度对组成系统的各部分进行搭配和安排，形成系统的多个结构而组成架构，它包括该系统的各个组件、组件的外部可见属性及组件之间的相互关系
- 软件的外部可见属性：符合其它组件可对该组件的要求

## 软件架构的结构

### 描述角度

- 静态角度
  - 模块结构
  - 分析类结构：分模块，模块内分功能
  - 类结构
- 动态角度
  - 进程结构
  - 数据流结构
  - 控制流结构
  - 使用结构：过程A的运行必须以过程B能正确运行为前提
  - 调用结构：过程A调用过程B
  - 层次结构：某一层只能调用其下一层
- 部署角度
  - 物理结构

### 结构间关系

- 可以从多个角度描述系统，即存在多个结构
- 一般注重一个主要结构
- 系统越大，结构带来的差距越大

### 4+1模型

全面地描述架构的方式

<img src="屏幕截图 2022-10-30 185158.jpg" alt="屏幕截图 2022-10-30 185158" style="zoom:50%;" />

## 架构的产生

- 架构是动态变化的，不是设计时就确定的
- 影响架构的因素：
  - 客户和最终环境
  - 开发组织
  - 技术环境
  - 设计师的经验、沟通能力

- 架构反过来影响项目、需求、设计师

## 架构的重要性

- 风险承担者交流的平台
- 早期设计决策的体现
- 有助于架构级重用

# MVC框架

- 组件：模型，视图，控制器
- 连接件：显示/隐式调用，其他（如http协议）
- 模型：控制数据存取，实现业务逻辑
- 视图：接受输入，向控制器发送请求，接收controller反馈，显示模型数据
- 控制器：向模型发送请求，向视图发送模型数据

- 优点：分离问题，可维护性好，便于分工，可拓展性强

# 软件架构样式

- 各组件运行的模式，数据传输的模式

## 类型

- 仓库式：各模块访问位于中心的数据
- 主动仓库式（黑板式）：中心的数据主动发送到各模块，并接收反馈
- 数据流式：数据输入是串行的，输入数据后的操作是串行的（同一个数据流内部串行，但可以同时存在多个数据流）
  - 批处理式：持续处理同一对象。对数据的结构有要求，不适合处理
  - 管道-过滤式：上一步骤的输出为下一步骤的输入。各部分逻辑高度分离，便于理解、维护、复用。但传输过程中类型转换开销高
- 虚拟机式：实现可移植性
- 调用-返回式：
  - 主程序-子程序式：面向过程，定义和使用函数。难以描述复杂的问题，可复用性差，数据安全性差
  - 远过程调用式
  - 面向对象式：便于复用、维护，低耦合，反映现实；但增加复杂度，降低效率
  - 分层式
- 独立组件式：各模块独立，通过中介交互，以降低耦合
  - 事件系统式
  - 通讯进程式
- C/S式：服务器管理数据，客户端与用户交互。无法支持多服务器，服务器负担过大，数据安全性差
  - 三层C/S结构：分出表现层、业务层、数据层，有助于将任务分散到更多软硬件上，利于分工、维护，数据安全性好
  - B/S式：表现层——浏览器，逻辑层——服务器，数据层——数据库服务器
  - C2式：各组件独立性强，均以连接件中介交互
  - 正交样式：树状。节点为组件，同一层节点互补依赖。从树根到叶的每条路径为一个线索，每条线索实现一种功能。结构清晰，利于维护、复用，可移植性强

## 参考模型到设计模式

具象到抽象：

- 参考模型：数据流动的过程中，数据类型的变化以及涉及到的功能模块
- 参考架构：各模块及其中的子模块
- 架构：系统的各个模块及其关系
- 框架：一组相互协作的模块的高层次描述
- 设计模式：设计模块遵循的规则

# 质量属性

- 质量属性：系统的各种特征

## 需求与架构

- 需求三要素：功能，质量，限制条件
- 需求是架构设计的基础，设计阶段无法确定全部需求，需要迭代

## 功能与架构

- 满足功能是架构的基本要求
- 功能和架构相互影响制约

## 质量属性与架构

- 架构是质量属性的基础，质量属性也受具体实现影响
- 运行时属性：可用性，性能，安全性，易用性
- 维护时属性：可修改性，可拓展性，可移植性，可集成性

- 描述质量属性，可以从使用质量属性场景：特定场景下，系统受到外界对象的刺激，产生反应，量化地评估反应

<img src="屏幕截图 2022-11-01 113458.jpg" alt="屏幕截图 2022-11-01 113458" style="zoom:50%;" />

## 限制条件

- 限制条件包括商业限制、技术限制、法律限制、社会限制等
- 商业限制：
  - 投放时间
  - 成本
  - （预计的）系统生命周期
  - 目标市场
  - 推出计划
  - 遗留系统集成

## 架构本身的质量属性

- 一致性
- 正确性和完整性：能满足系统的要求
- 可构建性

# 战术

- 战术是开发过程中影响质量控制的决策，架构策略是战术的集合
- 可用性战术：处理错误，解决功能问题的战术
  - 错误检测
  - 错误恢复
  - 错误预防
- 可修改性的战术：应对修改请求的战术
  - 局部化修改
  - 防止连锁反应
  - 推迟绑定时间：不把对象间的绑定写死
- 实施性能的战术：在性能约束下响应事件的战术
  - 控制对资源的需求
  - 减少需要同时处理事件的数量
  - 控制资源使用
- 实施安全性的战术：应对攻击的战术
  - 抵抗攻击
  - 检测攻击
  - 从攻击中恢复

# 设计构架

- 软件过程：对软件开发活动的组织、规范和管理
- 基于架构的开发步骤：构建一个商业案例→弄清系统需求→设计或选用构架→正确表述此构架并与有关各方交流→实现基于构架的系统→系统维护时，构架文档相应维护

## 构架设计评判原则

- 设计构架过程的建议：

  - 构架设计由设计师完成，设计师全面掌握系统技术需求和各项需求及其优先级

  - 构架文档完备，采用所有人员认可的文档形式

  - 各风险承担者积极参与构架评估

  - 构架设计有助于具体实现
  - 允许构架带来一定的资源争用，并给出可行的解决方案

- 构架结构的建议：
  - 构架由定义良好的模块组成
  - 模块的划分应体现出相互独立的原则
  - 尽量不依赖于某个特定版本的商用产品或工具
  - 把计算机基础结构的特性封装在一定的模块中
  - 对并发系统，构架应充分考虑进程与模块结构的不对应
  - 进程编写要考虑到与特定处理器的关系，并容易改变关系
  - 在合适的环境下遵循设计模式

## 架构设计的质量驱动方法

- 属性驱动的设计（ADD）：考虑一组质量属性场景，分析质量属性与构架设计之间的关系，以此设计构架。一个模块满足需求后，将其分解成子模块，考虑子模块如何满足需求
  - 样本输入：一些质量属性场景
  - 选择要分解的模块
  - 选择合适的架构模式，使所选模块满足需求
  - 定义子模块
  - 验证质量场景，使其成为子模块的需求
  - 重复上述步骤


## 创建骨架系统

### 意义

- 提高开发效率，鼓舞士气
- 尽早发现和考虑系统中复杂的部分
- 缩短系统集成时间，明确集成成本
- 便于评审和测试

### 步骤

- 先实现处理构架的各组件间交互的部分
- 逐步将组件添加到系统中
- 逐步测试

## 架构师的职责

- 明确业务目标
- 规划产品的开发和迭代
- 领导并负责架构设计（定义高层结构和接口）
- 规划建设架构级重用
- 为项目管理提供支持（分析技术可行性、任务划分、人员招聘）
- 领导和协调项目组的主要活动，参与主要产品的研发
- 讲解架构、指导设计和开发、协调冲突
- 规划和协助软件架构的评审
- 评估新技术并提出采用建议

# 架构评审的一般方法

## 架构评审的成本与收益

- 成本：人员、时间、组织成本
- 收益：
  - 尽早发现构架中存在的问题以改进构架
  - 验证需求的有效性
  - 捕获架构设计中的思想
  - 财务收益

## 评审技巧

- 定性技巧：场景，评审清单，问卷
- 定量技巧：指标，模拟，原型，实验

## 评审实践

- 预先规划评审环境
- 确定项目代表
- 建立评审小组
- 明确评审的目标（对评审的要求，不是对项目的要求）
- 制定评审日程

# 架构评审的ATAM方法

- ATAM(Architecture Tradeoff Analysis Method)：构架权衡分析法

## 参与人员

- 评估小组
- 项目决策人（客户/项目管理者/发出评审委托的人）
- 构架风险承担者

## 输入输出

- 输入：若干质量属性场景
- 输出：粗略的评价，可能包括构架表述、业务目标、质量需求与构架决策的关系、敏感点和权衡点、决策风险

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101155536872.png" alt="image-20221101155536872" style="zoom:50%;" />

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101155553113.png" alt="image-20221101155553113" style="zoom:50%;" />

## 阶段

- 确定要评估的内容（评估小组，项目决策人）
- 收集信息并分析（评估小组）
- 评估（评估小组，风险承担者）
  - ATAM方法的表述
  - 商业动机的表述
  - 构架表述
  - 对构架方法进行分类
  - 生成质量属性效用树
  - 分析构架方法
  - 讨论并确定场景优先级
  - 再次分构架方法
  - 结果表述
- 自我检查和改进，提交报告（评估小组）

## 利用有限的评估时间

- 以实现业务目标未动机
- 划分场景优先级
- 自顶向下生成效用树场景，自底向上进行分析
- 仅分析优先级高和较难实现的场景

# 架构文档的写作

- 目的：让不同的风险承担者快速找到和理解所需的信息
- 原则：从读者的角度出发

## 结构编档

- 将相关结构编程文档
  - 选择相关结构
    - 产生候选结构列表
    - 组合结构
    - 划分优先级
  - 结构编档：包括七部分
    - 用图形表示组件和组件间关系
    - 各组件的章节中详细描述组件的接口、行为及与其他组件的关系
    - 系统与其环境相关的上下文图
    - 可变性指南
    - 构架设计的背景
    - 术语表
    - 其他信息







## 项目背景

目前大多数的系统功能比较单一，针对更为普遍的情况，而随着服务行业的发展，管理系统的多元化也显得更加重要，为此我们设计了佩奇酒店管理，功能包括员工管理、客房预定系统、收银系统、账单管理系统、帐务报表、酒店服务等功能模块，创新的加入了服务订购、房间可视化、数据可视化等模块，实现了餐饮住宿娱乐企业日常营运的全面自动管理，是酒店进行电脑信息化管理的理想选择。

## 质量属性

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101153309529.png" alt="image-20221101153309529" style="zoom:50%;" />

## ADD设计方法

输入质量属性场景→选择模块→选择合适的架构模式→验证质量场景，在此基础上，分解出子模块

## 质量属性效用树

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101153150047.png" alt="image-20221101153150047" style="zoom:50%;" />

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101153203055.png" alt="image-20221101153203055" style="zoom:50%;" />

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101153218124.png" alt="image-20221101153218124" style="zoom:50%;" />

<img src="C:/Users/16571/AppData/Roaming/Typora/typora-user-images/image-20221101153232086.png" alt="image-20221101153232086" style="zoom:50%;" />

## 对属性进行战术评审

### 并发性

对于一般酒店而言，管理系统的高并发并不是一个刚需。但是考虑到系统可能应对特殊的情况，当连锁酒店使用这套系统时高并发就显得尤为关键，在办理入住以及相关服务时应当以尽量快的速度完成以保证客户的满意度。因此系统采用消息队列额来处理请求，即redis与mysql相结合的手段去处理高并发。登录系统时发送验证码、以及各个页面分页的第一页数据等都会使用redis，以加快访问和处理业务逻辑的速度。

### 高效性

为了提高页面与请求的响应速度，仅靠redis是远远不够的。因此在接口设计时采用返回局部数据的方法，即只返回当前页面所需数据。为此，设计了请求分页返回的方法，以及裁剪元组属性等，在每一次请求中尽量避免返回冗余数据。

## 构架师和项目经理配合

- 推荐开发方式和项目技术框架建议
- 定义项目
- 识别和划分任务
- 估算收益和开销
- 提供如何确定开发者定位方面的帮助
- 提供技术方面的建议和指导

