T：目标操作数 S：源操作数 L：标号

n:立即数

# 运算符

```assembly
thisArray EQU bigArray BYTE	;pArray和Array的地址相同，相当于Array的别名，但指向的空间是1BYTE,不占空间
Array DW 500 DUP (?) 	;变量实际上是指针，可以直接与立即数加减(两个指针可以相减不能相加)
A DW 0
pArray DB Array			;pArray的内容是Array的地址

BEGIN EQU THIS FAR 		 ;this取得下一语句的地址，FAR表明BEGIN是一个远标号，用于远转移
MOV CH,BL					

MOV AX,Array			;AX的内容变为Array指向的内容
MOV AX,OFFSET Array		;AX的内容变为Array的地址指向的内容
MOV AX,[Array]			;AX的内容变为Array的内容指向的内容
LEA AX,Array			;AX的内容变为Array
LEA AX,[Array]			;AX的内容变为Array的内容
LDS AX,Array			;AX的内容变为Array,DS的内容变为pArray+2/4

MOV AL,BYTE PTR pArray	;相当于强制类型转换（不能对寄存器使用）
MOV AX,OFFSET A-Array	;AX的内容变为A-Array间的地址跨度
;LEA AX,A-Array			;不合法的
```

| 运算符格式   | 功能                                                         | 备注                                    |
| ------------ | ------------------------------------------------------------ | --------------------------------------- |
| **OFFSET S** | &S                                                           | S可以是地址、内容，但不能含有寄存器     |
| [S]          | *S                                                           | S是寄存器名或立即数或变量，可附加表达式 |
| SEG S        | 取得S所在段的段址                                            | S是变量或标号                           |
| TYPE S       | S是变量时，返回sizeof(S)；S是近标号时，返回0FFFFH；S是远标号时，返回0FFFEH |                                         |
| LENGTH S     | S后**紧跟**“n DUP”时，返回n，否则返回1                       | S是变量                                 |
| SIZE A       | LENGTH A* TYPE A                                             | S是变量                                 |
| HIGH S       | 返回S的高8位                                                 | S为立即数，下同                         |
| LOW S        | 返回S的高8位                                                 |                                         |
| THIS         | 取得当前数据段的下一个可用地址                               |                                         |

# 寻址方式

**R:通用寄存器 M：存储单元 D：段寄存器 N：立即数 V:偏移量 F:比例系数 **

**偏移量可以是立即数、变量名、表达式，超出操作位数时会截去高位；比例系数只能是1，2，4，8**

| 名称           | 格式                        | 备注                 |
| -------------- | --------------------------- | -------------------- |
| 寄存器寻址     | R                           |                      |
| 寄存器间接寻址 | [R]                         | 有时可以指定D，下同  |
| 变址寻址       | [R *F+V]  [R *F]+V  V[R *F] | 下同                 |
| 基址加变址寻址 | 将上面的R改为BR+IR          | BR为BX/BP，IR为SI/DI |
| 立即寻址       | N                           | 注意指定数据类型     |
| 直接寻址       | D:[N]                       | 最好不要省略DS       |



| 操作类型           | 默认段寄存器 | 可选段寄存器 | 通用寄存器           |
| ------------------ | ------------ | ------------ | -------------------- |
| 栈                 | SS           |              | SP                   |
| 一般数据           | DS           | CS,ES,SS     | BX,SI,DI,BX+SI,BX+DI |
| 串操作的源操作数   | DS           | CS,ES,SS     | SI                   |
| 串操作的目的操作数 | ES           |              | DI                   |
|                    | SS           | CS,DS,ES     | BP,BP+SI,BP+DI       |

# 数据传送指令

**R:通用寄存器 M：存储单元 D：段寄存器（数据传送指令范围内，变量名和内存单元等价） N：立即数 **

| T    | 可使用的S | 备注                                                         |
| ---- | --------- | ------------------------------------------------------------ |
| R    | R/M/D/N/X | CS不能作S                                                    |
| M    | R/D/N     | EA只能是BX,BP,SI,DI，或BX/BP+SI/DI；S为N时，要指明数据类型；进行串操作时，应使用SI |
| D    | R/M       | CS不能作T                                                    |

**[S]中的S决定省略了的段寄存器名，S为变量名时，省略的段寄存器为DS**

**段寄存器可以参与数据传送，但不能参与算术运算，CS只读**

## 一般数据传送指令

**寄存器名也可以看作地址，立即数不应被视作一个数，而应该被视作存放了那个数的地址**

**不影响标志位**

| 指令格式       | 功能                           | 备注                                      |
| -------------- | ------------------------------ | ----------------------------------------- |
| **MOV**        | T= S                           |                                           |
| **MOVSX  T,S** | T= S                           | T为16位或32位寄存器，S为位数小于T的寄存器 |
| **MOVZX T,S**  | T=(unsigned)S                  | T为16位或32位寄存器，S为位数小于T的寄存器 |
| **XCHG T,S**   | 交换T和S的内容                 | S和T不能是立即数                          |
| BSWAP S        | 将S的1与4、2与3子节互换        | S是32位寄存器                             |
| XADD S,T       | 交换T和S的内容，T= T+ S        |                                           |
| **XLAT S**     | AL = S+AL                      | S为地址，通常S是转换表                    |
| XALT           | AL = BX+AL                     |                                           |
| PUSHA          | 16位下，将IP以外寄存器全部PUSH |                                           |
| POPA           | 16位下，将IP以外寄存器全部POP  |                                           |

## 地址传送指令

**不影响标志位**

```assembly
DATA1 SEGMENT USE16.
FINAL DD F
DATA1 ENDS	;不占用空间

DATA2 SEGMENT USE16
F DW 123
DATA2 ENDS

LDS SI,FINAL ;*SI=FINAL(0,因为SI在DATA2中的偏移地址是0)，*DS=FINAL+2(DATA2,因为FINAL之后就是DATA2,FINAL位于某一段的最后才有这种效果)
```

| 指令格式    | 功能             | 备注                                            |
| ----------- | ---------------- | ----------------------------------------------- |
| **LEA T,S** | T=&S             | T,S是地址，如果是[]表示的地址，可以在[]内作运算 |
| LDS T,S     | T= &S，DS= S+2/4 | T是16位/32位通用寄存器，S为DWORD/FWORD的地址    |
| LES/LSS     | 和LDS类似        |                                                 |

## 算术运算指令

**CF用于判断无符号运算是否溢出，OF用于判断有符号运算是否溢出，算术运算后，若CF=1，必有OF=1**

**DEC等单操作数指令不能对内存空间使用，但可以对变量使用**

| 指令格式     | 功能                                          | 备注                                                      |
| ------------ | --------------------------------------------- | --------------------------------------------------------- |
| CBW          | AX= AL                                        | 符号不变                                                  |
| NEG T        | T = ~ T+1                                     | 负数的补码的补码=绝对值                                   |
| **IMUL S**   | 乘数：AL,S 结果：AX                           | S为8位，不能是立即数,OF=CF=1表示溢出(高半部分不为0)，下同 |
| **IMUL S**   | 乘数：AX,S 结果：(DX,AX)                      |                                                           |
| **IMUL S**   | 乘数：EAX,S 结果：(EDX,EAX)                   |                                                           |
| **IMUL T,S** | 同上，T指定了AL,AX或EAX                       |                                                           |
| MUL S        | 同MUL S，无符号运算                           |                                                           |
| MUL T,S      | 同MUL T,S，无符号运算                         |                                                           |
| **IDIV S**   | 被除数：AX 除数：S 结果：AL 余数：AH          | S为8位，不能是立即数，下同                                |
| **IDIV S**   | 被除数：(DX,AX) 除数：S 结果：AX 余数：DX     | S为16位，不能是立即数                                     |
| **IDIV S**   | 被除数：(EDX,EAX) 除数：S 结果：EAX 余数：EDX | S为32位，不能是立即数                                     |
| DIV S        | 同DIV S，无符号运算                           |                                                           |

## 位操作指令

**位移量只能是立即数或CL的内容，某些情况下，立即数只能取1**

| 指令格式     | 功能                           | 备注                                                         |
| ------------ | ------------------------------ | ------------------------------------------------------------ |
| TEST T,S     | _=S& T                         |                                                              |
| **BT T,S**   | （仅影响CF）CF=T的第S位        | T为16位/32位，S不能是储存单元，若S的值超出16/32，对16/32取余 |
| **SHL T,n**  | 左移n位                        | CF=最后离开T的一位，下同                                     |
| **SHR T,n**  | 右移n位                        |                                                              |
| **SAL T,n**  | 符号位不变,左移n位             |                                                              |
| **SAR  T,n** | 符号位不变,右移n位             |                                                              |
| ROL T,n      | 循环左移n位,CF=最后离开T的一位 |                                                              |
| ROR T,n      | 循环右移n位,CF=最后离开T的一位 |                                                              |
| RCL T,n      | (CF,T)循环左移n位              |                                                              |
| RCR T,n      | (CF,T)循环右移n位              |                                                              |
| SHLD T,S,n   | T左移n位，空位由S的高n位填补   |                                                              |
| SHRD T,S,n   | T右移n位，空位由S的低n位填补   |                                                              |

## 串操作指令

**目的操作数总是ES:DI（或EDI），源操作数总是DS:SI(或ESI)。是否使用32位寄存器取决于数据段，而不是系统**

**使用后DI和SI总会变化，DF=0表示从小到大操作字符串（DI,SI增大），增大的量取决于指令**

| 指令格式 | 功能                        | 备注 |
| -------- | --------------------------- | ---- |
| CLD      | DF=0                        |      |
| STD      | DF=1                        |      |
| MOVSB    | 复制长1Byte的串             |      |
| CMPSB    | 比较长1Byte的串，相同时ZF=1 |      |
| STOSB S  | 给1Byte长的串赋S的值        |      |

# 跳转指令

**跳转范围只能在-128~127字节内**

| 指令格式       | 跳转条件         | 备注         |
| -------------- | ---------------- | ------------ |
| JE/JZ          | 等于             |              |
| JS             | 小于0            |              |
| JC             | 进位             |              |
| JO             | 溢出             |              |
| JA             | 无符号大于       |              |
| JAE            | 无符号大于等于   |              |
| JG             | 大于             |              |
| JGE            | 大于等于         |              |
| JB             | 无符号小于       |              |
| JBE            | 无符号小于等于   |              |
| JL             | 小于             |              |
| JLE            | 小于等于         |              |
| JP/JPE         | 有偶数个1 (PF=1) |              |
| JNP/JPO        | 有奇数个1PF=0    |              |
| LOOP           | CX!=0            | 先执行DEC CX |
| LOOPE/LOOPZ    | CX!=0,ZF=1       | 先执行DEC CX |
| LOOPNE,LOOPNZ  | CX!=0,ZF=0       | 先执行DEC CX |
| REP（串指令）  | CX!=0            | 先执行DEC CX |
| REPZ（串指令） | CX!=0 ZF=0       | 先执行DEC CX |

# 输入输出功能调用

```assembly
BUF DB 100		;用于接收结果的字符串
	DB ?
	DB 80 DUP(?)

LEA DX BUF
MOV AH,10
INT 21H
XOR BX,BX
MOV BL,BUF+1	;获取输入的字符串的长度
MOV BYTE PTR BUF+2[BX],'$'	;末尾补结束符
```



调用成功后CF=0，调用失败后CF=1且AX中存错误码

| 指令格式          | 功能                                                         | 备注                             |
| ----------------- | ------------------------------------------------------------ | -------------------------------- |
| MOV AH,1  INT 21H | 将下一个按下的键的ASCII码存入AL中                            |                                  |
| MOV AH,2  INT 21H | 显示DL中的ASCII码对应的字符                                  |                                  |
| MOV AH,9 INT 21H  | 显示以DX中的地址为首地址的字符串                             | 通常前有LEA DX,STR               |
| MOV AH,10 INT 21H | 输入字符串（以回车结束）并存入从DX中的地址开始的一段存储单元 | 用于接收输入的字符串定义是特殊的 |